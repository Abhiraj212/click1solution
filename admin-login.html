<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Admin Login - Click1Solutions Pvt. Ltd.">
    <meta name="robots" content="noindex, nofollow">
    <meta name="theme-color" content="#6366f1">
    <title>Admin Login | Click1Solutions Pvt. Ltd.</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Additional admin login styles */
        .admin-login {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: var(--space-lg);
            background: linear-gradient(135deg, var(--dark) 0%, var(--dark-light) 100%);
            position: relative;
        }
        
        .admin-login::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.03'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }
        
        .login-card {
            width: 100%;
            max-width: 420px;
            background: var(--white);
            border-radius: var(--radius-xl);
            padding: var(--space-2xl);
            box-shadow: var(--shadow-xl);
            position: relative;
            z-index: 1;
        }
        
        .login-header {
            text-align: center;
            margin-bottom: var(--space-xl);
        }
        
        .login-logo {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, #6366f1 0%, #06b6d4 100%);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto var(--space-lg);
        }
        
        .login-logo svg {
            width: 32px;
            height: 32px;
            color: var(--white);
        }
        
        .login-header h1 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: var(--space-sm);
        }
        
        .login-header p {
            color: var(--gray);
            font-size: 0.9375rem;
        }
        
        .login-error {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-md);
            background: rgba(220, 53, 69, 0.1);
            border-radius: var(--radius-md);
            color: var(--danger);
            font-size: 0.9375rem;
            margin-bottom: var(--space-lg);
        }
        
        .login-error.hidden {
            display: none;
        }
        
        .login-error svg {
            flex-shrink: 0;
        }
        
        .lockout-message {
            text-align: center;
            padding: var(--space-lg);
            background: rgba(255, 152, 0, 0.1);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-lg);
        }
        
        .lockout-message svg {
            width: 48px;
            height: 48px;
            color: var(--pending);
            margin-bottom: var(--space-md);
        }
        
        .lockout-message h3 {
            font-size: 1.125rem;
            color: var(--dark);
            margin-bottom: var(--space-sm);
        }
        
        .lockout-message p {
            color: var(--gray-dark);
            font-size: 0.9375rem;
        }
        
        .lockout-timer {
            font-size: 2rem;
            font-weight: 700;
            color: var(--pending);
            margin: var(--space-md) 0;
        }
        
        .password-wrapper {
            position: relative;
        }
        
        .password-toggle {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            padding: var(--space-sm);
            color: var(--gray);
            cursor: pointer;
        }
        
        .password-toggle:hover {
            color: var(--dark);
        }
        
        .security-note {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            margin-top: var(--space-xl);
            padding-top: var(--space-lg);
            border-top: 1px solid var(--gray-light);
            font-size: 0.875rem;
            color: var(--gray);
        }
        
        .security-note svg {
            flex-shrink: 0;
            color: var(--success);
        }
        
        .back-link {
            text-align: center;
            margin-top: var(--space-lg);
        }
        
        .back-link a {
            color: var(--gray);
            font-size: 0.9375rem;
        }
        
        .back-link a:hover {
            color: var(--primary);
        }
    </style>
</head>
<body>
    <div class="admin-login">
        <div class="login-card">
            <div class="login-header">
                <div class="login-logo">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                        <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                    </svg>
                </div>
                <h1>Admin Login</h1>
                <p>Secure access to Click1Solutions dashboard</p>
            </div>
            
            <!-- Lockout Message (hidden by default) -->
            <div id="lockoutMessage" class="lockout-message" style="display: none;">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                    <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                </svg>
                <h3>Account Temporarily Locked</h3>
                <p>Too many failed login attempts. Please try again after:</p>
                <div class="lockout-timer" id="lockoutTimer">10:00</div>
            </div>
            
            <!-- Login Form -->
            <form id="adminLoginForm" novalidate>
                <!-- Error Message -->
                <div id="loginError" class="login-error hidden">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="8" x2="12" y2="12"></line>
                        <line x1="12" y1="16" x2="12.01" y2="16"></line>
                    </svg>
                    <span id="errorText">Invalid credentials</span>
                </div>
                
                <div class="form-group">
                    <label for="username" class="form-label required">Username</label>
                    <input 
                        type="text" 
                        id="username" 
                        name="username" 
                        class="form-input" 
                        placeholder="Enter username"
                        required
                        autocomplete="username"
                    >
                </div>
                
                <div class="form-group">
                    <label for="password" class="form-label required">Password</label>
                    <div class="password-wrapper">
                        <input 
                            type="password" 
                            id="password" 
                            name="password" 
                            class="form-input" 
                            placeholder="Enter password"
                            required
                            autocomplete="current-password"
                            minlength="8"
                        >
                        <button type="button" class="password-toggle" id="passwordToggle" aria-label="Toggle password visibility">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" id="eyeIcon">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                <circle cx="12" cy="12" r="3"></circle>
                            </svg>
                        </button>
                    </div>
                </div>
                
                <button type="submit" class="btn btn-primary btn-block btn-lg" id="loginBtn">
                    Sign In
                </button>
            </form>
            
            <div class="security-note">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                </svg>
                <span>Secured with SHA-256 encryption. Maximum 3 login attempts.</span>
            </div>
            
            <div class="back-link">
                <a href="index.html">‚Üê Back to Website</a>
            </div>
        </div>
    </div>
    
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <p>Authenticating...</p>
    </div>
    
    <script src="security.js"></script>
    <script>
        // Admin Login Handler
        (function() {
            const form = document.getElementById('adminLoginForm');
            const loginError = document.getElementById('loginError');
            const errorText = document.getElementById('errorText');
            const loadingOverlay = document.getElementById('loadingOverlay');
            const passwordToggle = document.getElementById('passwordToggle');
            const passwordInput = document.getElementById('password');
            const lockoutMessage = document.getElementById('lockoutMessage');
            const lockoutTimer = document.getElementById('lockoutTimer');
            
            // Check for existing session (redirect if already logged in)
            if (SecurityModule.isSessionValid()) {
                window.location.href = 'admin-dashboard.html';
                return;
            }
            
            // Check lockout status on load
            checkLockoutStatus();
            
            // Password visibility toggle
            passwordToggle.addEventListener('click', function() {
                const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                passwordInput.setAttribute('type', type);
                
                // Update icon
                const eyeIcon = document.getElementById('eyeIcon');
                if (type === 'text') {
                    eyeIcon.innerHTML = `
                        <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                        <line x1="1" y1="1" x2="23" y2="23"></line>
                    `;
                } else {
                    eyeIcon.innerHTML = `
                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                        <circle cx="12" cy="12" r="3"></circle>
                    `;
                }
            });
            
            // Check lockout status
            function checkLockoutStatus() {
                const lockStatus = SecurityModule.isLoginLocked();
                if (lockStatus.locked) {
                    showLockout(lockStatus.remaining);
                    return true;
                }
                return false;
            }
            
            // Show lockout message
            function showLockout(minutes) {
                form.style.display = 'none';
                lockoutMessage.style.display = 'block';
                
                let seconds = minutes * 60;
                updateTimerDisplay(seconds);
                
                const timerInterval = setInterval(() => {
                    seconds--;
                    updateTimerDisplay(seconds);
                    
                    if (seconds <= 0) {
                        clearInterval(timerInterval);
                        form.style.display = 'block';
                        lockoutMessage.style.display = 'none';
                    }
                }, 1000);
            }
            
            // Update timer display
            function updateTimerDisplay(seconds) {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                lockoutTimer.textContent = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }
            
            // Form submission
            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                // Check lockout again
                if (checkLockoutStatus()) {
                    return;
                }
                
                // Hide previous errors
                loginError.classList.add('hidden');
                
                const username = document.getElementById('username').value.trim();
                const password = passwordInput.value;
                
                // Basic validation
                if (!username || !password) {
                    showError('Please enter both username and password');
                    return;
                }
                
                // Show loading
                loadingOverlay.classList.add('active');
                
                try {
                    // Attempt authentication
                    const result = await SecurityModule.authenticateAdmin(username, password);
                    
                    // Hide loading
                    loadingOverlay.classList.remove('active');
                    
                    if (result.success) {
                        // Store session token
                        sessionStorage.setItem('adminToken', result.token);
                        
                        // Redirect to dashboard
                        window.location.href = 'admin-dashboard.html';
                    } else {
                        showError(result.message);
                        
                        if (result.locked) {
                            setTimeout(() => checkLockoutStatus(), 100);
                        }
                    }
                } catch (error) {
                    console.error('Login error:', error);
                    loadingOverlay.classList.remove('active');
                    showError('An error occurred. Please try again.');
                }
            });
            
            // Show error message
            function showError(message) {
                errorText.textContent = message;
                loginError.classList.remove('hidden');
            }
            
            // Prevent back button after logout
            if (window.history && window.history.pushState) {
                window.history.pushState(null, '', window.location.href);
                window.onpopstate = function() {
                    window.history.pushState(null, '', window.location.href);
                };
            }
        })();
    </script>
</body>
</html>
