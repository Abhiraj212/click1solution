<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Admin Dashboard - Click1Solutions Pvt. Ltd.">
    <meta name="robots" content="noindex, nofollow">
    <meta name="theme-color" content="#6366f1">
    <title>Admin Dashboard | Click1Solutions Pvt. Ltd.</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Admin Header -->
    <header class="admin-header">
        <div class="container admin-header-inner">
            <a href="admin-dashboard.html" class="admin-logo">
                <div class="logo-icon" style="width: 35px; height: 35px; font-size: 0.875rem;">C1</div>
                <span>Admin Panel</span>
            </a>
            
            <div class="admin-user">
                <span>Administrator</span>
                <button class="btn btn-sm btn-danger" id="logoutBtn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 6px;">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                        <polyline points="16 17 21 12 16 7"></polyline>
                        <line x1="21" y1="12" x2="9" y2="12"></line>
                    </svg>
                    Logout
                </button>
            </div>
        </div>
    </header>
    
    <!-- Admin Main Content -->
    <main class="admin-main">
        <div class="container">
            <!-- Stats Cards -->
            <div class="dashboard-stats">
                <div class="stat-card pending">
                    <div class="stat-value" id="pendingCount">0</div>
                    <div class="stat-label">Pending</div>
                </div>
                <div class="stat-card approved">
                    <div class="stat-value" id="approvedCount">0</div>
                    <div class="stat-label">Approved</div>
                </div>
                <div class="stat-card rejected">
                    <div class="stat-value" id="rejectedCount">0</div>
                    <div class="stat-label">Rejected</div>
                </div>
                <div class="stat-card total">
                    <div class="stat-value" id="totalCount">0</div>
                    <div class="stat-label">Total</div>
                </div>
            </div>
            
            <!-- Filter Tabs -->
            <div class="dashboard-section">
                <div style="display: flex; gap: var(--space-sm); margin-bottom: var(--space-lg); flex-wrap: wrap;">
                    <button class="btn btn-sm btn-primary filter-btn active" data-filter="all">All Requests</button>
                    <button class="btn btn-sm btn-outline filter-btn" data-filter="pending">Pending</button>
                    <button class="btn btn-sm btn-outline filter-btn" data-filter="approved">Approved</button>
                    <button class="btn btn-sm btn-outline filter-btn" data-filter="rejected">Rejected</button>
                </div>
                
                <h2>Staff/Vendor Requests</h2>
                
                <div class="requests-table-container">
                    <table class="requests-table" id="requestsTable">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Service</th>
                                <th>Location</th>
                                <th>Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="requestsTableBody">
                            <!-- Dynamic content -->
                        </tbody>
                    </table>
                </div>
                
                <div class="empty-state" id="emptyState" style="display: none;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="16" y1="13" x2="8" y2="13"></line>
                        <line x1="16" y1="17" x2="8" y2="17"></line>
                        <polyline points="10 9 9 9 8 9"></polyline>
                    </svg>
                    <h3>No requests found</h3>
                    <p>There are no requests matching your filter.</p>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Approval Modal -->
    <div class="modal-overlay" id="approvalModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-icon success">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                </div>
                <h3>Approve Request</h3>
                <p>Are you sure you want to approve this request? The applicant will be notified.</p>
            </div>
            <div class="modal-footer" style="display: flex; gap: var(--space-md);">
                <button class="btn btn-outline" onclick="closeApprovalModal()" style="flex: 1;">Cancel</button>
                <button class="btn btn-success" id="confirmApproveBtn" style="flex: 1;">Approve</button>
            </div>
        </div>
    </div>
    
    <!-- Rejection Modal -->
    <div class="modal-overlay" id="rejectionModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-icon error">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="15" y1="9" x2="9" y2="15"></line>
                        <line x1="9" y1="9" x2="15" y2="15"></line>
                    </svg>
                </div>
                <h3>Reject Request</h3>
                <p>Are you sure you want to reject this request? This action cannot be undone.</p>
            </div>
            <div class="modal-footer" style="display: flex; gap: var(--space-md);">
                <button class="btn btn-outline" onclick="closeRejectionModal()" style="flex: 1;">Cancel</button>
                <button class="btn btn-danger" id="confirmRejectBtn" style="flex: 1;">Reject</button>
            </div>
        </div>
    </div>
    
    <!-- View Details Modal -->
    <div class="modal-overlay" id="detailsModal">
        <div class="modal" style="max-width: 600px;">
            <div class="modal-header" style="text-align: left;">
                <h3>Request Details</h3>
                <div id="requestDetails" style="margin-top: var(--space-lg);">
                    <!-- Dynamic content -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary btn-block" onclick="closeDetailsModal()">Close</button>
            </div>
        </div>
    </div>
    
    <!-- Cancel Modal (Double Confirmation) -->
    <div class="modal-overlay" id="cancelModal">
        <div class="modal">
            <!-- Step 1: First Confirmation -->
            <div id="cancelStep1" class="confirmation-step active">
                <div class="modal-header">
                    <div class="modal-icon" style="background: rgba(239, 68, 68, 0.1); color: var(--danger);">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                            <line x1="12" y1="9" x2="12" y2="13"></line>
                            <line x1="12" y1="17" x2="12.01" y2="17"></line>
                        </svg>
                    </div>
                    <h3>Delete Request?</h3>
                    <p>Are you sure you want to delete this request? This action cannot be undone.</p>
                </div>
                <div class="modal-footer" style="display: flex; gap: var(--space-md);">
                    <button class="btn btn-outline" onclick="closeCancelModal()" style="flex: 1;">No, Keep It</button>
                    <button class="btn btn-danger" onclick="proceedToCancelStep2()" style="flex: 1;">Yes, Delete</button>
                </div>
            </div>
            
            <!-- Step 2: Final Confirmation -->
            <div id="cancelStep2" class="confirmation-step">
                <div class="modal-header">
                    <div class="modal-icon" style="background: rgba(239, 68, 68, 0.1); color: var(--danger);">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="3 6 5 6 21 6"></polyline>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                        </svg>
                    </div>
                    <h3>Final Confirmation</h3>
                    <p><strong>Warning:</strong> This is your last chance. The request will be permanently removed from the system.</p>
                </div>
                <div class="modal-footer" style="display: flex; gap: var(--space-md);">
                    <button class="btn btn-outline" onclick="goBackToCancelStep1()" style="flex: 1;">Go Back</button>
                    <button class="btn btn-danger" onclick="confirmCancelRequest()" style="flex: 1;">Permanently Delete</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>
    
    <script src="security.js"></script>
    <script src="admin.js"></script>
    <script>
        // Dashboard-specific handlers
        (function() {
            // Logout handler
            document.getElementById('logoutBtn').addEventListener('click', function() {
                if (confirm('Are you sure you want to logout?')) {
                    SecurityModule.clearSession();
                    
                    // Clear sensitive data from memory
                    window.location.replace('admin-login.html');
                }
            });
            
            // Filter buttons
            const filterBtns = document.querySelectorAll('.filter-btn');
            filterBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    filterBtns.forEach(b => {
                        b.classList.remove('btn-primary', 'active');
                        b.classList.add('btn-outline');
                    });
                    this.classList.remove('btn-outline');
                    this.classList.add('btn-primary', 'active');
                    
                    const filter = this.dataset.filter;
                    renderRequests(filter);
                });
            });
            
            // Modal close handlers
            window.closeApprovalModal = function() {
                document.getElementById('approvalModal').classList.remove('active');
            };
            
            window.closeRejectionModal = function() {
                document.getElementById('rejectionModal').classList.remove('active');
            };
            
            window.closeDetailsModal = function() {
                document.getElementById('detailsModal').classList.remove('active');
            };
            
            // Cancel modal handlers
            window.closeCancelModal = function() {
                document.getElementById('cancelModal').classList.remove('active');
                document.getElementById('cancelStep1').classList.add('active');
                document.getElementById('cancelStep2').classList.remove('active');
            };
            
            window.proceedToCancelStep2 = function() {
                document.getElementById('cancelStep1').classList.remove('active');
                document.getElementById('cancelStep2').classList.add('active');
            };
            
            window.goBackToCancelStep1 = function() {
                document.getElementById('cancelStep2').classList.remove('active');
                document.getElementById('cancelStep1').classList.add('active');
            };
            
            // Close modals on overlay click
            document.querySelectorAll('.modal-overlay').forEach(overlay => {
                overlay.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.classList.remove('active');
                    }
                });
            });
        })();
    </script>
</body>
</html>
